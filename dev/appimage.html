


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Portable rootless xonsh build on AppImage &#8212; xonsh 0.9.16.dev21 documentation</title>
    <link rel="stylesheet" href="_static/numpy_friendly.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/runthis-client.min.js"></script>

    
    
     
        <script src="_static/jquery.cookie.js"></script>
    

    
     
        <script src="_static/cloud.base.js"></script>
    

    
     
        <script src="_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="_static/magic_conch.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Containers" href="containers.html" />
    <link rel="prev" title="Windows Guide" href="windows.html" />
     
        <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://xon.sh/appimage.html"/>

  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="containers.html" title="Containers"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="windows.html" title="Windows Guide"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="sidebar.html">xonsh 0.9.16.dev21 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">the xonsh shell</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="portable-rootless-xonsh-build-on-appimage">
<h1>Portable rootless xonsh build on AppImage<a class="headerlink" href="#portable-rootless-xonsh-build-on-appimage" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://appimage.org/">AppImage</a> is a format for distributing portable software on Linux without needing superuser permissions to install the application. It tries also to allow Linux distribution-agnostic binary software deployment for application developers, also called Upstream packaging.</p>
<p>AppImage allows xonsh to be run on any AppImage supported Linux distributive without installation and root access.</p>
<p align="center"><a href="https://asciinema.org/a/9AH5AtYxbrn5nRo83nm46Z34n" target="_blank"><img src="https://asciinema.org/a/9AH5AtYxbrn5nRo83nm46Z34n.svg" /></a></p><div class="section" id="try-it-now">
<h2>Try it now<a class="headerlink" href="#try-it-now" title="Permalink to this headline">¶</a></h2>
<p>You can download and try <a class="reference external" href="https://github.com/niess/linuxdeploy-plugin-python/releases">prebuilded xonsh.AppImage</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://github.com/niess/linuxdeploy-plugin-python/releases/download/continuous/xonsh-x86_64.AppImage -O xonsh.AppImage
chmod +x xonsh.AppImage
./xonsh.AppImage -c <span class="s2">&quot;echo @(1+1)&quot;</span>
./xonsh.AppImage
</pre></div>
</div>
</div>
<div class="section" id="build-xonsh-appimage">
<h2>Build xonsh.AppImage<a class="headerlink" href="#build-xonsh-appimage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dockerfile">
<h3><cite>Dockerfile</cite><a class="headerlink" href="#dockerfile" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FROM ubuntu:16.04
RUN apt update -y <span class="o">&amp;&amp;</span> apt upgrade -y
RUN apt install --no-install-recommends -y -qq <span class="se">\</span>
        fuse wget mc git <span class="se">\</span>
        build-essential python-dev python-setuptools python-pip python-smbus <span class="se">\</span>
        libncursesw5-dev lib32ncurses5-dev libgdbm-dev libc6-dev  <span class="se">\</span>
        zlib1g-dev libsqlite3-dev tk-dev libssl-dev openssl libffi-dev autoconf <span class="se">\</span>
        libfuse-dev libncurses5-dev libreadline-dev libdb5.3-dev libbz2-dev <span class="se">\</span>
        libexpat1-dev liblzma-dev  automake libfuse2

RUN mkdir -p /build /appimage
WORKDIR /build
RUN git clone --depth <span class="m">1</span> https://github.com/niess/linuxdeploy-plugin-python <span class="o">&amp;&amp;</span> <span class="se">\</span>
        <span class="nb">cd</span> linuxdeploy-plugin-python <span class="o">&amp;&amp;</span> <span class="se">\</span>
        git checkout 85d2e6fac5969d1b381f4da384248b368522ede3
CMD <span class="nb">cd</span> /build/linuxdeploy-plugin-python/appimage <span class="o">&amp;&amp;</span> ./build-python.sh xonsh <span class="o">&amp;&amp;</span> cp *.AppImage /appimage
</pre></div>
</div>
</div>
<div class="section" id="build-sh">
<h3><cite>build.sh</cite><a class="headerlink" href="#build-sh" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build --no-cache -t local/appimage-xonsh .
docker run --rm --privileged --device /dev/fuse -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:/appimage -it local/appimage-xonsh
</pre></div>
</div>
<p>As result you’ll find executable file <code class="docutils literal notranslate"><span class="pre">xonsh-x86_64.AppImage</span></code> that runs xonsh and can take command line arguments like xonsh. Enjoy!</p>
</div>
</div>
<div class="section" id="running-portable-python-and-pip">
<h2>Running portable python and pip<a class="headerlink" href="#running-portable-python-and-pip" title="Permalink to this headline">¶</a></h2>
<p>If you need to use python and pip from portable <cite>xonsh.AppImage</cite> just set up directories in <cite>~/.xonshrc</cite>:</p>
<div class="highlight-xonsh notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace host python to xonsh.AppImage python</span>
<span class="nv">$PATH</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$PYTHONHOME</span> <span class="o">+</span> <span class="s1">&#39;/bin&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$PATH</span>

<span class="c1"># setting up pip packages directory</span>
<span class="nv">$PIP_TARGET</span><span class="o">=</span><span class="s1">&#39;/tmp/xonsh/pip&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/tmp/xonsh/pip&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And magic is here:</p>
<div class="highlight-xonsh notranslate"><div class="highlight"><pre><span></span>xonsh$ pip3 install tqdm
xonsh$ ls /tmp/xonsh/pip/
tqdm
xonsh$ python
&gt;&gt;&gt; import tqdm
&gt;&gt;&gt; tqdm
&lt;module &#39;tqdm&#39; from &#39;/tmp/xonsh/pip/tqdm/__init__.py&#39;&gt;
&gt;&gt;&gt; # nice!
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python-importerror-no-module-named-site">
<h3>Python ImportError: No module named site<a class="headerlink" href="#python-importerror-no-module-named-site" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xonsh notranslate"><div class="highlight"><pre><span></span>xonsh$ python
ImportError: No module named site
</pre></div>
</div>
<p>The error above was appeared because host machine python try to find right path for <cite>site-packages</cite>. The fix is just using python from AppImage by setting right path to it across <cite>$PYTHONHOME</cite> which was set by AppImage:</p>
<div class="highlight-xonsh notranslate"><div class="highlight"><pre><span></span>xonsh$ $PATH = [$PYTHONHOME + &#39;/bin&#39;] + $PATH
xonsh$ python
Python 3.7.3
&gt;&gt;&gt; # success
</pre></div>
</div>
</div>
<div class="section" id="glibs-versions">
<h3>GLIBs versions<a class="headerlink" href="#glibs-versions" title="Permalink to this headline">¶</a></h3>
<p>You can noticed that we build AppImage in docker with older version of Ubuntu (16.04) to avoid error with core libraries versions when binary compiled on modern version can’t use older version of libraries. In this nasty case you can see the error like <code class="docutils literal notranslate"><span class="pre">/xonsh-x86_64.AppImage:</span> <span class="pre">/lib/x86_64-linux-gnu/libc.so.6:</span> <span class="pre">version</span> <span class="pre">GLIBC_2.25</span> <span class="pre">not</span> <span class="pre">found</span> <span class="pre">(required</span> <span class="pre">by</span> <span class="pre">/ppp/xonsh-x86_64.AppImage)</span></code>. This means you should rebuild the AppImage for older version of distributive. If you know how to fix it once and forever feel free to tell us.</p>
</div>
<div class="section" id="windows-subsystem-for-linux-v1-wsl1">
<h3>Windows Subsystem for Linux v1 (WSL1)<a class="headerlink" href="#windows-subsystem-for-linux-v1-wsl1" title="Permalink to this headline">¶</a></h3>
<p>Need WSL support:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wsl1# ./xonsh.AppImage
fuse: device not found, try <span class="s1">&#39;modprobe fuse&#39;</span> first

Cannot mount AppImage, please check your FUSE setup.
You might still be able to extract the contents of this AppImage
<span class="k">if</span> you run it with the --appimage-extract option.
See https://github.com/AppImage/AppImageKit/wiki/FUSE
<span class="k">for</span> more information
open dir error: No such file or directory
</pre></div>
</div>
<p>Workaround is extracting appimage and run manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wsl1$ ./xonsh.AppImage --appimage-extract
wsl1$ ./squashfs-root/usr/bin/python3.7
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="sidebar.html" title="sidebar">
          <img class="logo" src="_static/ascii_conch_part_transparent_tight.png" alt="Logo"/>
        </a></p><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="sidebar.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Portable rootless xonsh build on AppImage</a><ul>
<li><a class="reference internal" href="#try-it-now">Try it now</a></li>
<li><a class="reference internal" href="#build-xonsh-appimage">Build xonsh.AppImage</a><ul>
<li><a class="reference internal" href="#dockerfile"><cite>Dockerfile</cite></a></li>
<li><a class="reference internal" href="#build-sh"><cite>build.sh</cite></a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-portable-python-and-pip">Running portable python and pip</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#python-importerror-no-module-named-site">Python ImportError: No module named site</a></li>
<li><a class="reference internal" href="#glibs-versions">GLIBs versions</a></li>
<li><a class="reference internal" href="#windows-subsystem-for-linux-v1-wsl1">Windows Subsystem for Linux v1 (WSL1)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="windows.html"
                          title="Previous page">&larr; Windows Guide</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="containers.html"
                          title="Next page">&rarr; Containers</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/appimage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="containers.html" title="Containers"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="windows.html" title="Windows Guide"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="sidebar.html">xonsh 0.9.16.dev21 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >the xonsh shell</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Anthony Scopatz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>